---
title: "Soil Data Analysis USDA NCRS STATSGO2 U.S. National Soil Survey Data"
output: html_notebook
---

### How to Use this Notebook Instructions

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing the first code chunk below by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


## Load the Environment Package Dependencies

```{r}
# modeled after tutorial at http://ncss-tech.github.io/AQP/soilDB/SDA-tutorial.html
# Soil data presented were derived from the 100+ year efforts of 
# the National Cooperative Soil Survey, c/o USDA-NRCS

# # install the packages
# # only once if you have not previously installed these
# install.packages('aqp', dep=TRUE)
# install.packages('soilDB', dep=TRUE)
# install.packages('sharpshootR', dep=TRUE)
# install.packages('plyr', dep=TRUE)
# install.packages('RColorBrewer', dep=TRUE)
# install.packages('httr', dep=TRUE)
# install.packages('rgdal', dep=TRUE)
# install.packages('raster', dep=TRUE)
# install.packages('rgeos', dep=TRUE)
# install.packages("kableExtra")
# # get latest versions from GitHub
# install.packages('devtools', dep=TRUE)
# devtools::install_github("ncss-tech/soilDB", dependencies=FALSE, upgrade_dependencies=FALSE)

# load packages
library(aqp)
library(plyr)
library(cluster)
library(ape)
library(colorspace)
library(soilDB)
library(sharpshootR)
library(plyr)
library(RColorBrewer)
library(latticeExtra)
library(httr)
library(rgdal)
library(raster)
library(rgeos)
library(kableExtra)
```
## Exploratory Data Analysis

### Warmup with Some Soil Colors

```{r}
# colors from Official Series Descriptions
s.list <- c('amador', 'redding', 'pentz', 'willows', 'pardee', 'yolo', 'hanford', 'cecil', 'sycamore', 'KLAMATH', 'MOGLIA', 'vleck', 'drummer', 'CANEYHEAD', 'musick', 'sierra', 'HAYNER', 'zook', 'argonaut', 'PALAU')

# get these soil series
s <- fetchOSD(s.list)

# manually convert Munsell -> sRGB
rgb.data <- munsell2rgb(s$hue, s$value, s$chroma, return_triplets = TRUE)
s$r <- rgb.data$r
s$g <- rgb.data$g
s$b <- rgb.data$b

# Look at full range of OSD colors in this set.
# Colors, arranged by Î”E00.
previewColors(s$soil_color)
```
## Some General Exploration of the Data Source

With all records in the data tables with areasymbol 'US' comprising the STATSGO2 data tables.

Note, according to the Soil Data Mart Query Guide, "STATSGO is an acronym that corresponds to the United States general soil map data.

For STATSGO there is only one survey area whose map scale is approximately
1:250,000. STATSGO spans the 50 U.S. states, the District of Columbia, Puerto Rico and the Virgin Islands. 

For the single STATSGO survey area, legend.areatypename = 'Country' and legend.areasymbol = 'US'."

For more information, see *Discriminating between SSURGO and STATSGO* at https://sdmdataaccess.sc.egov.usda.gov/documents/DiscriminatingBetweenSSURGOAndSTATSGO.pdf

#### Recency of records
```{r}
# When was the last survey exported to STATSGO? Show most recent at top.
SDA_query("SELECT areasymbol, saverest FROM sacatalog WHERE areasymbol = 'US' ORDER BY saverest desc")
```
```{r}
SDA_query("SELECT *")
```
